<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Home — M/s Onkarnath Agrawal Sarraf (Bachcha Sarraf )</title>
  <link rel="icon" type="image/x-icon" href="assets/img/logo.png">
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Fine jewellery — gold, diamond, silver.">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body class="bg-white text-slate-900">

  <!-- Header -->
<header class="sticky top-0 z-40 bg-white/90 backdrop-blur border-b">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <a href="index.html" class="flex items-center gap-3 text-2xl font-serif text-yellow-800 tracking-wide">
      <img src="assets/img/logo.png" alt="Brand Logo" class="h-12 md:h-16 object-contain bg-white rounded-md p-1 shadow-md border border-yellow-700">
      <span class="font-semibold">M/s Onkarnath Agrawal Sarraf (Bachcha Sarraf)</span>
    </a>
    <nav class="hidden md:flex gap-6 text-sm">
      <a href="catalog.html">Catalog</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </nav>
  </div>
</header>


<!-- EXTENDED GOLD & SILVER RATES -->
<section class="border-t border-b bg-gradient-to-r from-yellow-50 via-white to-yellow-50 backdrop-blur">
  <div class="max-w-6xl mx-auto px-4 py-12 md:py-16 min-h-[50vh]">
    
    <div class="text-center mb-10">
      <h2 class="text-3xl md:text-5xl font-semibold leading-tight">Today’s Extended Gold & Silver Rates</h2>
      <p class="mt-4 text-slate-600 text-base md:text-lg">
        Bank, Cash, Jewellery & MCX indicative prices — auto-updated from live spot rates.
      </p>
      <div id="rates-updated" class="mt-3 text-sm text-slate-500"></div>
    </div>

    <!-- Rate cards -->
    <div id="extended-rates" class="grid sm:grid-cols-2 md:grid-cols-3 gap-5"></div>

    <div class="text-xs text-slate-500 text-center mt-6">
      *MCX prices are indicative, derived from spot market data.
    </div>
  </div>
</section>



  <!-- Hero -->
  <section class="max-w-6xl mx-auto px-4 py-10 grid md:grid-cols-2 gap-8 items-center">
    <div>
      <h1 class="text-3xl md:text-5xl font-semibold leading-tight">Elegant Gold & Diamond Jewellery</h1>
      <p class="mt-4 text-slate-600">Handcrafted designs. Hallmarked purity. Transparent pricing linked to today’s gold rate.</p>
      <div class="mt-6 flex gap-3">
        <a href="catalog.html" class="px-5 py-3 rounded-xl bg-black text-white">Shop Catalog</a>
        <a href="contact.html" class="px-5 py-3 rounded-xl border">Book a Visit</a>
      </div>
    </div>
    <img src="assets/img/hero.jpg" class="rounded-2xl w-full object-cover" alt="Hero">
  </section>



  <!-- New Arrivals -->
  <section class="max-w-6xl mx-auto px-4 py-10">
    <h2 class="text-xl font-semibold mb-4">New Arrivals</h2>
    <div id="featured" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    <div id="featured-empty" class="hidden text-center text-slate-500 py-8">No items to show.</div>
  </section>

  <!-- Scripts -->
  <script>
    // Robust CSV parser (handles quotes/commas/newlines)
    function parseCSV(text) {
      const rows = [];
      let i = 0, cur = '', row = [], inQuotes = false;
      while (i < text.length) {
        const c = text[i];
        if (c === '"') {
          if (inQuotes && text[i+1] === '"') { cur += '"'; i++; }
          else inQuotes = !inQuotes;
        } else if (c === ',' && !inQuotes) { row.push(cur); cur = ''; }
        else if ((c === '\n' || c === '\r') && !inQuotes) {
          if (cur !== '' || row.length) { row.push(cur); rows.push(row); cur=''; row=[]; }
        } else { cur += c; }
        i++;
      }
      if (cur !== '' || row.length) { row.push(cur); rows.push(row); }
      return rows;
    }

    async function loadCSV(url){
      const t = await (await fetch(url, {cache:'no-cache'})).text();
      const parsed = parseCSV(t.trim());
      const head = parsed[0].map(h=>h.trim());
      return parsed.slice(1)
        .filter(r => r && r.length && r.some(cell => (cell||'').trim() !== ''))
        .map(r => Object.fromEntries(head.map((h,i)=>[h, (r[i]||'').trim()])));
    }

    function purityFromKarat(k){
      const n = Number(k||0);
      if (n === 24) return '24K';
      if (n === 22) return '22K';
      if (n === 18) return '18K';
      return '';
    }
    function metalFromRow(karat, stone){
      const k = Number(karat||0);
      if (k > 0) return 'Gold';
      if ((stone||'').toLowerCase() === 'diamond') return 'Diamond';
      return 'Silver';
    }

    (async () => {
      // Rates bar
      fetch('data/rates.json', {cache:'no-cache'})
        .then(r => r.ok ? r.json() : Promise.reject())
        .then(d => {
          document.getElementById('rate-bar').innerText =
            `Gold 24K: ₹${d.gold24k}/g | 22K: ₹${d.gold22k}/g | Silver: ₹${d.silver}/g — Updated ${d.updated}`;
        })
        .catch(()=>{ document.getElementById('rate-bar').innerText = 'Rates unavailable'; });

      // New Arrivals (top by id desc)
      const rows = await loadCSV('data/products.csv');
      const items = rows.map(x => ({
        id: x.id,
        name: x.name,
        category: (x.category||'').toLowerCase(),
        karat: Number(x.karat||0),
        purity: purityFromKarat(x.karat),
        metal: metalFromRow(x.karat, x.stone),
        weight_g: Number(x.weight_g||0),
        image_url: x.image_url || 'assets/img/placeholder.webp',
        description: x.description || ''
      }));

      const featuredEl = document.getElementById('featured');
      const emptyEl = document.getElementById('featured-empty');

      const newest = items
        .sort((a,b) => (Number(b.id||0) - Number(a.id||0)))
        .slice(0, 8); // show up to 8 newest

      if (!newest.length) {
        emptyEl.classList.remove('hidden');
        return;
      }

      featuredEl.innerHTML = newest.map(x => `
        <a href="product.html?id=${encodeURIComponent(x.id)}"
           class="block rounded-2xl border hover:shadow transition overflow-hidden bg-white">
          <img src="${x.image_url}" alt="${x.name}" loading="lazy"
               onerror="this.onerror=null;this.src='assets/img/placeholder.webp';"
               class="w-full aspect-square object-cover" />
          <div class="p-3">
            <h3 class="font-semibold truncate" title="${x.name}">${x.name}</h3>
            <p class="text-sm text-slate-600">
              ${x.metal}${x.purity ? ' ' + x.purity : ''} • ${x.weight_g || 0}g
            </p>
          </div>
        </a>
      `).join('');
    })();


  fetch('data/rates.json', {cache:'no-cache'})
    .then(r => r.ok ? r.json() : Promise.reject())
    .then(d => {
      const r24 = Number(d.gold24k||0);
      const r22 = Number(d.gold22k||0);
      const r18 = Math.round(r24 * 0.75);
      const rs  = Number(d.silver||0);
      document.getElementById('home-rate24').textContent = '₹' + r24.toLocaleString('en-IN');
      document.getElementById('home-rate22').textContent = '₹' + r22.toLocaleString('en-IN');
      document.getElementById('home-rate18').textContent = '₹' + r18.toLocaleString('en-IN');
      document.getElementById('home-ratesilver').textContent = '₹' + rs.toLocaleString('en-IN');
      document.getElementById('rates-updated').textContent = 'Updated ' + (d.updated || '');
      const rb = document.getElementById('rate-bar');
      if (rb) rb.textContent =
        `Gold 24K: ₹${r24}/g | 22K: ₹${r22}/g | Silver: ₹${rs}/g — Updated ${d.updated || ''}`;
    })
    .catch(() => {
      const rb = document.getElementById('rate-bar');
      if (rb) rb.textContent = 'Rates unavailable';
      const u = document.getElementById('rates-updated');
      if (u) u.textContent = 'Rates unavailable';
    });

    (async () => {
  const r = await fetch('data/rates.json', {cache:'no-cache'}).then(x => x.json());

  // --- CONFIG (edit values to fine-tune spreads) ---
  const cfg = {
    bank_cash_spread_pct_gold: 0.15,
    bank_cash_spread_pct_silver: 0.20,
    k22_factor: 0.9167,
    k20_factor: 0.8333,
    k18_factor: 0.7500,
    mcx_gold_lot_g: 10,
    mcx_silver_lot_g: 1000,
    mcx_gold_premium_pct: 0.00,
    mcx_silver_premium_pct: 0.00
  };

  // base per-gram rates
  const g24 = Number(r.gold24k || 0);
  const s = Number(r.silver || 0);

  // derived variants
  const gold_bank   = Math.round(g24 * (1 + cfg.bank_cash_spread_pct_gold/100));
  const gold_cash   = Math.round(g24 * (1 - cfg.bank_cash_spread_pct_gold/100));
  const silver_bank = Math.round(s   * (1 + cfg.bank_cash_spread_pct_silver/100));
  const silver_cash = Math.round(s   * (1 - cfg.bank_cash_spread_pct_silver/100));
  const g22 = Math.round(g24 * cfg.k22_factor);
  const g20 = Math.round(g24 * cfg.k20_factor);
  const g18 = Math.round(g24 * cfg.k18_factor);
  const mcxGold   = Math.round(g24 * cfg.mcx_gold_lot_g  * (1 + cfg.mcx_gold_premium_pct/100));
  const mcxSilver = Math.round(s   * cfg.mcx_silver_lot_g * (1 + cfg.mcx_silver_premium_pct/100));

  const rows = [
    ['24 ct bank gold', `₹${gold_bank.toLocaleString('en-IN')}/g`],
    ['24 ct cash gold', `₹${gold_cash.toLocaleString('en-IN')}/g`],
    ['bank silver', `₹${silver_bank.toLocaleString('en-IN')}/g`],
    ['cash silver', `₹${silver_cash.toLocaleString('en-IN')}/g`],
    ['22 ct gold jewellery', `₹${g22.toLocaleString('en-IN')}/g`],
    ['20 ct gold jewellery', `₹${g20.toLocaleString('en-IN')}/g`],
    ['18 ct gold jewellery', `₹${g18.toLocaleString('en-IN')}/g`],
    ['MCX gold live*', `₹${mcxGold.toLocaleString('en-IN')} / 10g`],
    ['MCX silver live*', `₹${mcxSilver.toLocaleString('en-IN')} / kg`]
  ];

  const grid = document.getElementById('extended-rates');
  grid.innerHTML = rows.map(([k, v]) => `
    <div class="rounded-2xl border p-5 bg-white/80 hover:shadow-lg transition">
      <div class="text-xs uppercase tracking-wide text-slate-500">${k}</div>
      <div class="mt-2 text-2xl md:text-3xl font-bold">${v}</div>
    </div>
  `).join('');

  document.getElementById('rates-updated').textContent =
    `Updated ${r.updated || ''} — Source: ${r.source || 'Live feed'}`;
})();

  </script>
</body>
</html>
